<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>购物袋</title>
    <link rel="shortcut icon" href="../images/public/favicon.ico" />
    <link rel="bookmark" href="../images/public/favicon.ico" />
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../font/font-public/font_657azfexyst/iconfont.css">
    <link rel="stylesheet" href="../css/public.css">
    <link rel="stylesheet" href="../css/shoppingcar.css">
</head>

<body>
    <!-- 头部 -->
    <div class="header">
        <div class="header-logo">
            <h1 class="fl"><a href=""><img class="logo" src="../images/register/cartHeader.png" alt=""></a></h1>
            <div class="header-service fr"><img src="../images/register/right.png" alt=""></div>
        </div>

    </div>
    <!-- 表格 -->
    <table id="tb">
        <thead>
            <tr>
                <th class="th1">精选特卖</th>
                <th class="th2">单价</th>
                <th class="th3">数量</th>
                <th class="th4">小计</th>
                <th class="th5">操作</th>
            </tr>
        </thead>
        <tbody>
            
        </tbody>
        <tfoot>
            <tr>
                <td>

                </td>
            </tr>
        </tfoot>
    </table>
    <!-- 结算 -->
    <div class="bar-wrapper">
        <div class="bar-right">
            <div class="piece">已选全部商品<strong class="piece_num"></strong></div>
            <div class="totalMoney">共计: <strong class="total_text">0.00</strong></div>
            <div class="calBtn"><a href="javascript:;">立即结算</a></div>
        </div>
    </div>
    <!-- 三个图片 -->
    <div class="info">
        <div class="first fl">
            <img src="../images/gouwuche/01img.png" alt="">
        </div>
        <div class="two fl">
            <img src="../images/gouwuche/02img.png" alt="">
        </div>
        <div class="three fl">
            <img src="../images/gouwuche/03img.png" alt="">
        </div>
    </div>
    <!-- 底部开始 -->
    <footer class="footer">
        <div class="footer-inner clear">

            <div class="footer-infor">
                <p class="footer-infor-link">
                    <a href="">关于我们</a>|
                    <a href="">About us</a>|
                    <a href="">Investor Relations</a>|
                    <a href="">媒体报道</a>|
                    <a href="">品牌招商</a>|
                    <a href="">隐私条款</a>|
                    <a href="">诚聘招聘</a>|
                    <a href="">唯品卡</a>|
                    <a href="">联系我们</a>
                </p>
                <p class="footer-infor-txt">
                    Copyright © 2008-2019 vip.com，All Rights Reserved 使用本网站即表示接受 <a href="">唯品会用户协议</a> 。版权所有 <a
                        href="">广州唯品会电子商务有限公司</a> <br> <a href="">粤公网安备 44010302111111号</a>&nbsp;&nbsp;<a
                        href="">粤ICP备08114786号</a> <a href="">增值业务经营许可证：粤B2-20170777</a> <a
                        href="">网络文化经营许可证：粤网文〔2018〕5030-1743号</a><br>
                    <a href="">自营主体经营证照</a> &nbsp;&nbsp;<a href="">风险监测信息</a>&nbsp;&nbsp; <a
                        href="">互联网药品信息服务资格证书：（粤）-经营性-2018-0271</a> <a href="">网络食品交易第三方平台备案凭证：粤B2-20170777</a> <a
                        href="">医疗器械网络交易服务第三方平台备案凭证：（粤）网械平台备字[2019]第00001号</a>
                </p>
            </div>
        </div>
        <div class="footer-ft">
            <p class="footer-pic">
                <a href="">
                    <i class="footer-pic-ico01"></i>
                </a>
                <a href="">
                    <i class="footer-pic-ico02"></i>
                </a>
                <a href="">
                    <i class="footer-pic-ico03"></i>
                </a>
                <a href="">
                    <i class="footer-pic-ico04"></i>
                </a>
                <a href="">
                    <i class="footer-pic-ico05"></i>
                </a>
                <a href="">
                    <i class="footer-pic-ico06"></i>
                </a>
                <a href="">
                    <i class="footer-pic-ico07"></i>
                </a>
            </p>
        </div>
    </footer>
    <!-- 底部结束 -->
    <!-- 右栏开始 -->
    <script src="../js/jquery.js"></script>
    <script src="../js/cookie.js"></script>
    <script>
        var cart = {
            allChecked: true, //是否全选
            total: 0,
           
        };
        // 取cookie
        var goods = getCookie("goods")?JSON.parse(getCookie("goods")):[];
       
        cart.items = goods;
        // 根据数据动态生成表格
        var tbody = document.querySelector('tbody');
        // 不可以
        fillCart();

        function fillCart() {
            // 计算 小计

            subTotal()
            var str = "";
            for (var i = 0; i < cart.items.length; i++) {
                str = str + `
                <tr>
                    <td>${cart.items[i].goodsName}</td>
                    <td class="price">￥${cart.items[i].goodsPrice}</td>
                    <td class="count">
                        <i class="reduce">-</i>
                        <b class="countNum">1</b>
                        <i class="add">+</i>
                    </td>
                    <td class="subTotal">￥${cart.items[i].subTotal}</td>
                    <td>
                        <a href="javascript:;" class="del">删除</a>
                    </td>
             </tr>
                `
            }

            tbody.innerHTML = str;
            // 总价格
            var allCheck = document.querySelectorAll(".allCheck");

            for (var i = 0; i < allCheck.length; i++) {
                allCheck[i].checked = cart.allChecked;

            }
            $(".total_text").html(caltTotal(cart.items));

            // 可以获取
            var add = document.querySelectorAll('.add');
            var reduce = document.querySelectorAll('.reduce');
            for (var i = 0; i < add.length; i++) {
                add[i].index = i;
                add[i].onclick = function () {
                    //alert(1);
                    cart.items[this.index].itemNum = cart.items[this.index].itemNum + 1;
                    fillCart();
                    $(".countNum").html(cart.items[this.index].itemNum);
                }
            }
            for (var i = 0; i < reduce.length; i++) {
                reduce[i].index = i;
                reduce[i].onclick = function () {
                    //alert(1);
                    cart.items[this.index].itemNum = cart.items[this.index].itemNum - 1;
                    fillCart();
                    $(".countNum").html(cart.items[this.index].itemNum);
                }
            }
            // 商品选中和取消选中
            // 获取选择框
            var checks = document.querySelectorAll('.check');
            for (var i = 0; i < checks.length; i++) {
                checks[i].index = i;
                checks[i].onchange = function () {
                    // console.log(this.index);
                    // console.log(this.checked);
                    cart.items[this.index].isChecked = this.checked;
                    var {
                        items
                    } = cart;
                    if (items.every(el => el.isChecked)) {
                        cart.allChecked = true;
                    } else {
                        cart.allChecked = false;
                    }
                    /* var res = items.every(function(el){
                        return el.isChecked
                    });
                    if(res){

                    } */
                    fillCart();
                }
            }

            // 全选 取消全选
            var allCheck = document.querySelectorAll(".allCheck");
            for (var i = 0; i < allCheck.length; i++) {
                allCheck[i].onchange = function () {
                    cart.allChecked = this.checked;
                    // 当取消 选中时 所有的商品要取消选择
                    if (!this.checked) {
                        cart.items.forEach(function (el) {
                            el.isChecked = false;
                        });
                    } else {
                        cart.items.map(function (el) {
                            el.isChecked = true;
                        });
                    }
                    fillCart();
                }
            }

            // 删除
            var del = document.querySelectorAll(".del");
            for (var i = 0; i < del.length; i++) {
                del[i].index = i;
                del[i].onclick = function () {
                    if (confirm("您确认删除吗")) {
                        cart.items.splice(this.index, 1);
                        fillCart();
                    }
                }
            }
        }


        // 计算小计
        function subTotal() {
            for (var i = 0; i < cart.items.length; i++) {
                if(!cart.items[i].itemNum){
                    cart.items[i].itemNum = 1;
                }
                cart.items[i].subTotal = parseFloat((cart.items[i].goodsPrice * cart.items[i].itemNum).toFixed(2));
            }
        }


        //计算总价格
        function caltTotal(items) {
            
            var total = 0;

            for (var i = 0; i < items.length; i++) {
                total += items[i].subTotal;
            }

            return total;
        }
    </script>
</body>

</html>